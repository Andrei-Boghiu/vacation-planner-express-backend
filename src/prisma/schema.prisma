generator client {
    provider = "prisma-client-js"
    // output   = "../../generated/prisma"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
    EMPLOYEE
    MANAGER
    ADMIN
}

enum VacationStatus {
    PENDING
    APPROVED
    REJECTED
    CANCELLED
}

model User {
    id               String            @id @default(cuid(2))
    discordId        String            @unique
    email            String            @unique
    firstName        String?
    lastName         String?
    role             Role              @default(EMPLOYEE)
    availableDays    Int               @default(22) // available days per year 
    vacations        VacationRequest[] @relation("EmployeeVacations")
    managedVacations VacationRequest[] @relation("ManagerApproval")
    auditLogs        AuditLog[]        @relation("UserActions")
    createdAt        DateTime          @default(now())
    updatedAt        DateTime          @updatedAt
}

model VacationRequest {
    id          String         @id @default(cuid(2))
    user        User           @relation("EmployeeVacations", fields: [userId], references: [id])
    userId      String
    startDate   DateTime
    endDate     DateTime
    status      VacationStatus @default(PENDING)
    reason      String? // optional note from employee
    manager     User?          @relation("ManagerApproval", fields: [managerId], references: [id])
    managerId   String?
    managerNote String? // optional comment on approval/rejection
    createdAt   DateTime       @default(now())
    updatedAt   DateTime       @updatedAt
}

model AuditLog {
    id        String   @id @default(cuid(2))
    action    String // e.g. "CREATE_REQUEST", "APPROVE_REQUEST"
    actor     User     @relation("UserActions", fields: [actorId], references: [id])
    actorId   String
    targetId  String? // e.g. vacation request ID
    details   String?
    createdAt DateTime @default(now())
}
